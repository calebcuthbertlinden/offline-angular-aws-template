{"ast":null,"code":"import _asyncToGenerator from \"/Users/caleblinden/Documents/GitHub/mmf-poc/mmf-poc/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { InjectionToken } from '@angular/core';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"./local-storage\";\nimport * as i2 from \"./offline-service\";\nexport const APP_STORAGE = new InjectionToken('APP_STORAGE');\nexport const IDENTITY_TABLE = 'identity';\nexport const NUGGET_TABLE = 'nugget';\nclass SyncService {\n  constructor(localstorageService, onlineOfflineService) {\n    this.localstorageService = localstorageService;\n    this.registerToEvents(onlineOfflineService);\n    this.online = onlineOfflineService.isOnline;\n  }\n  registerToEvents(onlineOfflineService) {\n    onlineOfflineService.connectionChanged.subscribe(online => {\n      if (online) {\n        console.log('went online');\n        this.online = true;\n        console.log('sending all stored items');\n      } else {\n        console.log('went offline, storing in indexdb');\n        this.online = false;\n      }\n    });\n  }\n  // -----------------------------------------------------------------------------------------------------\n  // @ Public methods\n  // -----------------------------------------------------------------------------------------------------\n  post(table, path, body) {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      if (_this.online) {\n        return _this.localstorageService.post(table, body);\n      } else {\n        return _this.localstorageService.post(table, body);\n      }\n    })();\n  }\n  get(table, path, id) {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      if (_this2.online) {\n        return _this2.localstorageService.get(table, id);\n      } else {\n        return _this2.localstorageService.get(table, id);\n      }\n    })();\n  }\n  get$(table) {\n    if (this.online) {\n      return this.localstorageService.get$(table);\n    } else {\n      return this.localstorageService.get$(table);\n    }\n  }\n  getCollection(table) {\n    var _this3 = this;\n    return _asyncToGenerator(function* () {\n      return _this3.localstorageService.getCollection(table);\n    })();\n  }\n}\nSyncService.ɵfac = function SyncService_Factory(t) {\n  return new (t || SyncService)(i0.ɵɵinject(i1.LocalStorageService), i0.ɵɵinject(i2.OnlineOfflineService));\n};\nSyncService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: SyncService,\n  factory: SyncService.ɵfac,\n  providedIn: 'root'\n});\nexport { SyncService };","map":{"version":3,"names":["InjectionToken","APP_STORAGE","IDENTITY_TABLE","NUGGET_TABLE","SyncService","constructor","localstorageService","onlineOfflineService","registerToEvents","online","isOnline","connectionChanged","subscribe","console","log","post","table","path","body","_this","_asyncToGenerator","get","id","_this2","get$","getCollection","_this3","i0","ɵɵinject","i1","LocalStorageService","i2","OnlineOfflineService","factory","ɵfac","providedIn"],"sources":["/Users/caleblinden/Documents/GitHub/mmf-poc/mmf-poc/src/app/data/sync-service.ts"],"sourcesContent":["import { Injectable, InjectionToken } from '@angular/core';\nimport { LocalStorageService } from './local-storage';\nimport { Observable } from 'rxjs';\nimport { OnlineOfflineService } from './offline-service';\n\nexport const APP_STORAGE = new InjectionToken<any>('APP_STORAGE');\nexport const IDENTITY_TABLE = 'identity';\nexport const NUGGET_TABLE = 'nugget';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class SyncService {\n\n  private online:boolean;\n\n  constructor(private localstorageService: LocalStorageService, onlineOfflineService: OnlineOfflineService) {\n    this.registerToEvents(onlineOfflineService);\n    this.online = onlineOfflineService.isOnline;\n  }\n\n  private registerToEvents(onlineOfflineService: OnlineOfflineService) {\n    onlineOfflineService.connectionChanged.subscribe(online => {\n      if (online) {\n        console.log('went online');\n        this.online = true;\n        console.log('sending all stored items');\n      } else {\n        console.log('went offline, storing in indexdb');\n        this.online = false;\n      }\n    });\n  }\n\n  // -----------------------------------------------------------------------------------------------------\n  // @ Public methods\n  // -----------------------------------------------------------------------------------------------------\n\n  async post(table: string, path: string, body: any): Promise<any> {\n    if (this.online) {\n      return this.localstorageService.post(table, body)\n    } else {\n      return this.localstorageService.post(table, body)\n    }\n  }\n\n  async get(table: string, path: string, id: string): Promise<any> {\n    if (this.online) {\n      return this.localstorageService.get(table, id)\n    } else {\n      return this.localstorageService.get(table, id)\n    }\n  }\n\n  get$(table: string): Observable<any> {\n    if (this.online) {\n      return this.localstorageService.get$(table);\n    } else {\n      return this.localstorageService.get$(table);\n    }\n  }\n\n  async getCollection(table: string): Promise<any> {\n    return this.localstorageService.getCollection(table);\n  }\n\n}"],"mappings":";AAAA,SAAqBA,cAAc,QAAQ,eAAe;;;;AAK1D,OAAO,MAAMC,WAAW,GAAG,IAAID,cAAc,CAAM,aAAa,CAAC;AACjE,OAAO,MAAME,cAAc,GAAG,UAAU;AACxC,OAAO,MAAMC,YAAY,GAAG,QAAQ;AAEpC,MAGaC,WAAW;EAItBC,YAAoBC,mBAAwC,EAAEC,oBAA0C;IAApF,KAAAD,mBAAmB,GAAnBA,mBAAmB;IACrC,IAAI,CAACE,gBAAgB,CAACD,oBAAoB,CAAC;IAC3C,IAAI,CAACE,MAAM,GAAGF,oBAAoB,CAACG,QAAQ;EAC7C;EAEQF,gBAAgBA,CAACD,oBAA0C;IACjEA,oBAAoB,CAACI,iBAAiB,CAACC,SAAS,CAACH,MAAM,IAAG;MACxD,IAAIA,MAAM,EAAE;QACVI,OAAO,CAACC,GAAG,CAAC,aAAa,CAAC;QAC1B,IAAI,CAACL,MAAM,GAAG,IAAI;QAClBI,OAAO,CAACC,GAAG,CAAC,0BAA0B,CAAC;OACxC,MAAM;QACLD,OAAO,CAACC,GAAG,CAAC,kCAAkC,CAAC;QAC/C,IAAI,CAACL,MAAM,GAAG,KAAK;;IAEvB,CAAC,CAAC;EACJ;EAEA;EACA;EACA;EAEMM,IAAIA,CAACC,KAAa,EAAEC,IAAY,EAAEC,IAAS;IAAA,IAAAC,KAAA;IAAA,OAAAC,iBAAA;MAC/C,IAAID,KAAI,CAACV,MAAM,EAAE;QACf,OAAOU,KAAI,CAACb,mBAAmB,CAACS,IAAI,CAACC,KAAK,EAAEE,IAAI,CAAC;OAClD,MAAM;QACL,OAAOC,KAAI,CAACb,mBAAmB,CAACS,IAAI,CAACC,KAAK,EAAEE,IAAI,CAAC;;IAClD;EACH;EAEMG,GAAGA,CAACL,KAAa,EAAEC,IAAY,EAAEK,EAAU;IAAA,IAAAC,MAAA;IAAA,OAAAH,iBAAA;MAC/C,IAAIG,MAAI,CAACd,MAAM,EAAE;QACf,OAAOc,MAAI,CAACjB,mBAAmB,CAACe,GAAG,CAACL,KAAK,EAAEM,EAAE,CAAC;OAC/C,MAAM;QACL,OAAOC,MAAI,CAACjB,mBAAmB,CAACe,GAAG,CAACL,KAAK,EAAEM,EAAE,CAAC;;IAC/C;EACH;EAEAE,IAAIA,CAACR,KAAa;IAChB,IAAI,IAAI,CAACP,MAAM,EAAE;MACf,OAAO,IAAI,CAACH,mBAAmB,CAACkB,IAAI,CAACR,KAAK,CAAC;KAC5C,MAAM;MACL,OAAO,IAAI,CAACV,mBAAmB,CAACkB,IAAI,CAACR,KAAK,CAAC;;EAE/C;EAEMS,aAAaA,CAACT,KAAa;IAAA,IAAAU,MAAA;IAAA,OAAAN,iBAAA;MAC/B,OAAOM,MAAI,CAACpB,mBAAmB,CAACmB,aAAa,CAACT,KAAK,CAAC;IAAC;EACvD;;AApDWZ,WAAW,C;mBAAXA,WAAW,EAAAuB,EAAA,CAAAC,QAAA,CAAAC,EAAA,CAAAC,mBAAA,GAAAH,EAAA,CAAAC,QAAA,CAAAG,EAAA,CAAAC,oBAAA;AAAA;AAAX5B,WAAW,C;SAAXA,WAAW;EAAA6B,OAAA,EAAX7B,WAAW,CAAA8B,IAAA;EAAAC,UAAA,EAFV;AAAM;SAEP/B,WAAW"},"metadata":{},"sourceType":"module","externalDependencies":[]}