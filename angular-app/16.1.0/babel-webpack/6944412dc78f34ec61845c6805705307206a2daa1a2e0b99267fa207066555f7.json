{"ast":null,"code":"import { add as unloadAdd } from 'unload';\n\n/**\n * sends and internal message over the broadcast-channel\n */\nexport function sendLeaderMessage(leaderElector, action) {\n  var msgJson = {\n    context: 'leader',\n    action: action,\n    token: leaderElector.token\n  };\n  return leaderElector.broadcastChannel.postInternal(msgJson);\n}\nexport function beLeader(leaderElector) {\n  leaderElector.isLeader = true;\n  leaderElector._hasLeader = true;\n  var unloadFn = unloadAdd(function () {\n    return leaderElector.die();\n  });\n  leaderElector._unl.push(unloadFn);\n  var isLeaderListener = function isLeaderListener(msg) {\n    if (msg.context === 'leader' && msg.action === 'apply') {\n      sendLeaderMessage(leaderElector, 'tell');\n    }\n    if (msg.context === 'leader' && msg.action === 'tell' && !leaderElector._dpLC) {\n      /**\n       * another instance is also leader!\n       * This can happen on rare events\n       * like when the CPU is at 100% for long time\n       * or the tabs are open very long and the browser throttles them.\n       * @link https://github.com/pubkey/broadcast-channel/issues/414\n       * @link https://github.com/pubkey/broadcast-channel/issues/385\n       */\n      leaderElector._dpLC = true;\n      leaderElector._dpL(); // message the lib user so the app can handle the problem\n      sendLeaderMessage(leaderElector, 'tell'); // ensure other leader also knows the problem\n    }\n  };\n\n  leaderElector.broadcastChannel.addEventListener('internal', isLeaderListener);\n  leaderElector._lstns.push(isLeaderListener);\n  return sendLeaderMessage(leaderElector, 'tell');\n}","map":{"version":3,"names":["add","unloadAdd","sendLeaderMessage","leaderElector","action","msgJson","context","token","broadcastChannel","postInternal","beLeader","isLeader","_hasLeader","unloadFn","die","_unl","push","isLeaderListener","msg","_dpLC","_dpL","addEventListener","_lstns"],"sources":["/Users/caleblinden/Documents/GitHub/mmf-poc/mmf-poc/node_modules/broadcast-channel/dist/esbrowser/leader-election-util.js"],"sourcesContent":["import { add as unloadAdd } from 'unload';\n\n/**\n * sends and internal message over the broadcast-channel\n */\nexport function sendLeaderMessage(leaderElector, action) {\n  var msgJson = {\n    context: 'leader',\n    action: action,\n    token: leaderElector.token\n  };\n  return leaderElector.broadcastChannel.postInternal(msgJson);\n}\nexport function beLeader(leaderElector) {\n  leaderElector.isLeader = true;\n  leaderElector._hasLeader = true;\n  var unloadFn = unloadAdd(function () {\n    return leaderElector.die();\n  });\n  leaderElector._unl.push(unloadFn);\n  var isLeaderListener = function isLeaderListener(msg) {\n    if (msg.context === 'leader' && msg.action === 'apply') {\n      sendLeaderMessage(leaderElector, 'tell');\n    }\n    if (msg.context === 'leader' && msg.action === 'tell' && !leaderElector._dpLC) {\n      /**\n       * another instance is also leader!\n       * This can happen on rare events\n       * like when the CPU is at 100% for long time\n       * or the tabs are open very long and the browser throttles them.\n       * @link https://github.com/pubkey/broadcast-channel/issues/414\n       * @link https://github.com/pubkey/broadcast-channel/issues/385\n       */\n      leaderElector._dpLC = true;\n      leaderElector._dpL(); // message the lib user so the app can handle the problem\n      sendLeaderMessage(leaderElector, 'tell'); // ensure other leader also knows the problem\n    }\n  };\n\n  leaderElector.broadcastChannel.addEventListener('internal', isLeaderListener);\n  leaderElector._lstns.push(isLeaderListener);\n  return sendLeaderMessage(leaderElector, 'tell');\n}"],"mappings":"AAAA,SAASA,GAAG,IAAIC,SAAS,QAAQ,QAAQ;;AAEzC;AACA;AACA;AACA,OAAO,SAASC,iBAAiBA,CAACC,aAAa,EAAEC,MAAM,EAAE;EACvD,IAAIC,OAAO,GAAG;IACZC,OAAO,EAAE,QAAQ;IACjBF,MAAM,EAAEA,MAAM;IACdG,KAAK,EAAEJ,aAAa,CAACI;EACvB,CAAC;EACD,OAAOJ,aAAa,CAACK,gBAAgB,CAACC,YAAY,CAACJ,OAAO,CAAC;AAC7D;AACA,OAAO,SAASK,QAAQA,CAACP,aAAa,EAAE;EACtCA,aAAa,CAACQ,QAAQ,GAAG,IAAI;EAC7BR,aAAa,CAACS,UAAU,GAAG,IAAI;EAC/B,IAAIC,QAAQ,GAAGZ,SAAS,CAAC,YAAY;IACnC,OAAOE,aAAa,CAACW,GAAG,CAAC,CAAC;EAC5B,CAAC,CAAC;EACFX,aAAa,CAACY,IAAI,CAACC,IAAI,CAACH,QAAQ,CAAC;EACjC,IAAII,gBAAgB,GAAG,SAASA,gBAAgBA,CAACC,GAAG,EAAE;IACpD,IAAIA,GAAG,CAACZ,OAAO,KAAK,QAAQ,IAAIY,GAAG,CAACd,MAAM,KAAK,OAAO,EAAE;MACtDF,iBAAiB,CAACC,aAAa,EAAE,MAAM,CAAC;IAC1C;IACA,IAAIe,GAAG,CAACZ,OAAO,KAAK,QAAQ,IAAIY,GAAG,CAACd,MAAM,KAAK,MAAM,IAAI,CAACD,aAAa,CAACgB,KAAK,EAAE;MAC7E;AACN;AACA;AACA;AACA;AACA;AACA;AACA;MACMhB,aAAa,CAACgB,KAAK,GAAG,IAAI;MAC1BhB,aAAa,CAACiB,IAAI,CAAC,CAAC,CAAC,CAAC;MACtBlB,iBAAiB,CAACC,aAAa,EAAE,MAAM,CAAC,CAAC,CAAC;IAC5C;EACF,CAAC;;EAEDA,aAAa,CAACK,gBAAgB,CAACa,gBAAgB,CAAC,UAAU,EAAEJ,gBAAgB,CAAC;EAC7Ed,aAAa,CAACmB,MAAM,CAACN,IAAI,CAACC,gBAAgB,CAAC;EAC3C,OAAOf,iBAAiB,CAACC,aAAa,EAAE,MAAM,CAAC;AACjD"},"metadata":{},"sourceType":"module","externalDependencies":[]}