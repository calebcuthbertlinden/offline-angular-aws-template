{"ast":null,"code":"import _asyncToGenerator from \"/Users/caleblinden/Documents/GitHub/mmf-poc/mmf-poc/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { distinctUntilChanged, filter, map, shareReplay, startWith } from 'rxjs/operators';\nimport { clone, trimDots, pluginMissing, flatClone, PROMISE_RESOLVE_NULL, RXJS_SHARE_REPLAY_DEFAULTS, getFromObjectOrThrow, getProperty } from './plugins/utils';\nimport { newRxError } from './rx-error';\nimport { runPluginHooks } from './hooks';\nimport { getDocumentDataOfRxChangeEvent } from './rx-change-event';\nimport { overwritable } from './overwritable';\nimport { getSchemaByObjectPath } from './rx-schema-helper';\nimport { throwIfIsStorageWriteError } from './rx-storage-helper';\nimport { modifierFromPublicToInternal } from './incremental-write';\nexport var basePrototype = {\n  get primaryPath() {\n    var _this = this;\n    if (!_this.isInstanceOfRxDocument) {\n      return undefined;\n    }\n    return _this.collection.schema.primaryPath;\n  },\n  get primary() {\n    var _this = this;\n    if (!_this.isInstanceOfRxDocument) {\n      return undefined;\n    }\n    return _this._data[_this.primaryPath];\n  },\n  get revision() {\n    var _this = this;\n    if (!_this.isInstanceOfRxDocument) {\n      return undefined;\n    }\n    return _this._data._rev;\n  },\n  get deleted$() {\n    var _this = this;\n    if (!_this.isInstanceOfRxDocument) {\n      return undefined;\n    }\n    return _this.$.pipe(map(d => d._deleted));\n  },\n  get deleted() {\n    var _this = this;\n    if (!_this.isInstanceOfRxDocument) {\n      return undefined;\n    }\n    return _this._data._deleted;\n  },\n  getLatest() {\n    var latestDocData = this.collection._docCache.getLatestDocumentData(this.primary);\n    return this.collection._docCache.getCachedRxDocument(latestDocData);\n  },\n  /**\n   * returns the observable which emits the plain-data of this document\n   */\n  get $() {\n    var _this = this;\n    return _this.collection.$.pipe(filter(changeEvent => !changeEvent.isLocal), filter(changeEvent => changeEvent.documentId === this.primary), map(changeEvent => getDocumentDataOfRxChangeEvent(changeEvent)), startWith(_this.collection._docCache.getLatestDocumentData(this.primary)), distinctUntilChanged((prev, curr) => prev._rev === curr._rev), map(docData => this.collection._docCache.getCachedRxDocument(docData)), shareReplay(RXJS_SHARE_REPLAY_DEFAULTS));\n  },\n  /**\n   * returns observable of the value of the given path\n   */\n  get$(path) {\n    if (overwritable.isDevMode()) {\n      if (path.includes('.item.')) {\n        throw newRxError('DOC1', {\n          path\n        });\n      }\n      if (path === this.primaryPath) {\n        throw newRxError('DOC2');\n      }\n\n      // final fields cannot be modified and so also not observed\n      if (this.collection.schema.finalFields.includes(path)) {\n        throw newRxError('DOC3', {\n          path\n        });\n      }\n      var schemaObj = getSchemaByObjectPath(this.collection.schema.jsonSchema, path);\n      if (!schemaObj) {\n        throw newRxError('DOC4', {\n          path\n        });\n      }\n    }\n    return this.$.pipe(map(data => getProperty(data, path)), distinctUntilChanged());\n  },\n  /**\n   * populate the given path\n   */\n  populate(path) {\n    var schemaObj = getSchemaByObjectPath(this.collection.schema.jsonSchema, path);\n    var value = this.get(path);\n    if (!value) {\n      return PROMISE_RESOLVE_NULL;\n    }\n    if (!schemaObj) {\n      throw newRxError('DOC5', {\n        path\n      });\n    }\n    if (!schemaObj.ref) {\n      throw newRxError('DOC6', {\n        path,\n        schemaObj\n      });\n    }\n    var refCollection = this.collection.database.collections[schemaObj.ref];\n    if (!refCollection) {\n      throw newRxError('DOC7', {\n        ref: schemaObj.ref,\n        path,\n        schemaObj\n      });\n    }\n    if (schemaObj.type === 'array') {\n      return refCollection.findByIds(value).exec().then(res => {\n        var valuesIterator = res.values();\n        return Array.from(valuesIterator);\n      });\n    } else {\n      return refCollection.findOne(value).exec();\n    }\n  },\n  /**\n   * get data by objectPath\n   */\n  get(objPath) {\n    if (!this._data) {\n      return undefined;\n    }\n    var fromCache = this._propertyCache.get(objPath);\n    if (fromCache) {\n      return fromCache;\n    }\n    var valueObj = getProperty(this._data, objPath);\n\n    // direct return if array or non-object\n    if (typeof valueObj !== 'object' || Array.isArray(valueObj)) {\n      return overwritable.deepFreezeWhenDevMode(valueObj);\n    }\n\n    /**\n     * TODO find a way to deep-freeze together with defineGetterSetter\n     * so we do not have to do a deep clone here.\n     */\n    valueObj = clone(valueObj);\n    defineGetterSetter(this.collection.schema, valueObj, objPath, this);\n    this._propertyCache.set(objPath, valueObj);\n    return valueObj;\n  },\n  toJSON(withMetaFields = false) {\n    if (!withMetaFields) {\n      var data = flatClone(this._data);\n      delete data._rev;\n      delete data._attachments;\n      delete data._deleted;\n      delete data._meta;\n      return overwritable.deepFreezeWhenDevMode(data);\n    } else {\n      return overwritable.deepFreezeWhenDevMode(this._data);\n    }\n  },\n  toMutableJSON(withMetaFields = false) {\n    return clone(this.toJSON(withMetaFields));\n  },\n  /**\n   * updates document\n   * @overwritten by plugin (optional)\n   * @param updateObj mongodb-like syntax\n   */\n  update(_updateObj) {\n    throw pluginMissing('update');\n  },\n  incrementalUpdate(_updateObj) {\n    throw pluginMissing('update');\n  },\n  updateCRDT(_updateObj) {\n    throw pluginMissing('crdt');\n  },\n  putAttachment() {\n    throw pluginMissing('attachments');\n  },\n  getAttachment() {\n    throw pluginMissing('attachments');\n  },\n  allAttachments() {\n    throw pluginMissing('attachments');\n  },\n  get allAttachments$() {\n    throw pluginMissing('attachments');\n  },\n  modify(mutationFunction,\n  // used by some plugins that wrap the method\n  _context) {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      var oldData = _this2._data;\n      var newData = yield modifierFromPublicToInternal(mutationFunction)(oldData);\n      return _this2._saveData(newData, oldData);\n    })();\n  },\n  /**\n   * runs an incremental update over the document\n   * @param function that takes the document-data and returns a new data-object\n   */\n  incrementalModify(mutationFunction,\n  // used by some plugins that wrap the method\n  _context) {\n    return this.collection.incrementalWriteQueue.addWrite(this._data, modifierFromPublicToInternal(mutationFunction)).then(result => this.collection._docCache.getCachedRxDocument(result));\n  },\n  patch(patch) {\n    var oldData = this._data;\n    var newData = clone(oldData);\n    Object.entries(patch).forEach(([k, v]) => {\n      newData[k] = v;\n    });\n    return this._saveData(newData, oldData);\n  },\n  /**\n   * patches the given properties\n   */\n  incrementalPatch(patch) {\n    return this.incrementalModify(docData => {\n      Object.entries(patch).forEach(([k, v]) => {\n        docData[k] = v;\n      });\n      return docData;\n    });\n  },\n  /**\n   * saves the new document-data\n   * and handles the events\n   */\n  _saveData(newData, oldData) {\n    var _this3 = this;\n    return _asyncToGenerator(function* () {\n      newData = flatClone(newData);\n\n      // deleted documents cannot be changed\n      if (_this3._data._deleted) {\n        throw newRxError('DOC11', {\n          id: _this3.primary,\n          document: _this3\n        });\n      }\n      yield beforeDocumentUpdateWrite(_this3.collection, newData, oldData);\n      var writeResult = yield _this3.collection.storageInstance.bulkWrite([{\n        previous: oldData,\n        document: newData\n      }], 'rx-document-save-data');\n      var isError = writeResult.error[_this3.primary];\n      throwIfIsStorageWriteError(_this3.collection, _this3.primary, newData, isError);\n      yield _this3.collection._runHooks('post', 'save', newData, _this3);\n      return _this3.collection._docCache.getCachedRxDocument(getFromObjectOrThrow(writeResult.success, _this3.primary));\n    })();\n  },\n  /**\n   * Remove the document.\n   * Notice that there is no hard delete,\n   * instead deleted documents get flagged with _deleted=true.\n   */\n  remove() {\n    var _this4 = this;\n    var collection = this.collection;\n    if (this.deleted) {\n      return Promise.reject(newRxError('DOC13', {\n        document: this,\n        id: this.primary\n      }));\n    }\n    var deletedData = flatClone(this._data);\n    var removedDocData;\n    return collection._runHooks('pre', 'remove', deletedData, this).then( /*#__PURE__*/_asyncToGenerator(function* () {\n      deletedData._deleted = true;\n      var writeResult = yield collection.storageInstance.bulkWrite([{\n        previous: _this4._data,\n        document: deletedData\n      }], 'rx-document-remove');\n      var isError = writeResult.error[_this4.primary];\n      throwIfIsStorageWriteError(collection, _this4.primary, deletedData, isError);\n      return getFromObjectOrThrow(writeResult.success, _this4.primary);\n    })).then(removed => {\n      removedDocData = removed;\n      return this.collection._runHooks('post', 'remove', deletedData, this);\n    }).then(() => {\n      return this.collection._docCache.getCachedRxDocument(removedDocData);\n    });\n  },\n  incrementalRemove() {\n    var _this5 = this;\n    return this.incrementalModify( /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator(function* (docData) {\n        yield _this5.collection._runHooks('pre', 'remove', docData, _this5);\n        docData._deleted = true;\n        return docData;\n      });\n      return function (_x) {\n        return _ref2.apply(this, arguments);\n      };\n    }()).then( /*#__PURE__*/function () {\n      var _ref3 = _asyncToGenerator(function* (newDoc) {\n        yield _this5.collection._runHooks('post', 'remove', newDoc._data, newDoc);\n        return newDoc;\n      });\n      return function (_x2) {\n        return _ref3.apply(this, arguments);\n      };\n    }());\n  },\n  destroy() {\n    throw newRxError('DOC14');\n  }\n};\nexport function createRxDocumentConstructor(proto = basePrototype) {\n  var constructor = function RxDocumentConstructor(collection, docData) {\n    this.collection = collection;\n\n    // assume that this is always equal to the doc-data in the database\n    this._data = docData;\n    this._propertyCache = new Map();\n\n    /**\n     * because of the prototype-merge,\n     * we can not use the native instanceof operator\n     */\n    this.isInstanceOfRxDocument = true;\n  };\n  constructor.prototype = proto;\n  return constructor;\n}\nexport function defineGetterSetter(schema, valueObj, objPath = '', thisObj = false) {\n  if (valueObj === null) {\n    return;\n  }\n  var pathProperties = getSchemaByObjectPath(schema.jsonSchema, objPath);\n  if (typeof pathProperties === 'undefined') return;\n  if (pathProperties.properties) pathProperties = pathProperties.properties;\n  Object.keys(pathProperties).forEach(key => {\n    var fullPath = trimDots(objPath + '.' + key);\n\n    // getter - value\n    valueObj.__defineGetter__(key, function () {\n      var _this = thisObj ? thisObj : this;\n      if (!_this.get || typeof _this.get !== 'function') {\n        /**\n         * When an object gets added to the state of a vuejs-component,\n         * it happens that this getter is called with another scope.\n         * To prevent errors, we have to return undefined in this case\n         */\n        return undefined;\n      }\n      var ret = _this.get(fullPath);\n      return ret;\n    });\n    // getter - observable$\n    Object.defineProperty(valueObj, key + '$', {\n      get: function () {\n        var _this = thisObj ? thisObj : this;\n        return _this.get$(fullPath);\n      },\n      enumerable: false,\n      configurable: false\n    });\n    // getter - populate_\n    Object.defineProperty(valueObj, key + '_', {\n      get: function () {\n        var _this = thisObj ? thisObj : this;\n        return _this.populate(fullPath);\n      },\n      enumerable: false,\n      configurable: false\n    });\n    // setter - value\n    valueObj.__defineSetter__(key, function (val) {\n      var _this = thisObj ? thisObj : this;\n      return _this.set(fullPath, val);\n    });\n  });\n}\nexport function createWithConstructor(constructor, collection, jsonData) {\n  var doc = new constructor(collection, jsonData);\n  runPluginHooks('createRxDocument', doc);\n  return doc;\n}\nexport function isRxDocument(obj) {\n  return typeof obj === 'object' && obj !== null && 'isInstanceOfRxDocument' in obj;\n}\nexport function beforeDocumentUpdateWrite(collection, newData, oldData) {\n  /**\n   * Meta values must always be merged\n   * instead of overwritten.\n   * This ensures that different plugins do not overwrite\n   * each others meta properties.\n   */\n  newData._meta = Object.assign({}, oldData._meta, newData._meta);\n\n  // ensure modifications are ok\n  if (overwritable.isDevMode()) {\n    collection.schema.validateChange(oldData, newData);\n  }\n  return collection._runHooks('pre', 'save', newData, oldData);\n}","map":{"version":3,"names":["distinctUntilChanged","filter","map","shareReplay","startWith","clone","trimDots","pluginMissing","flatClone","PROMISE_RESOLVE_NULL","RXJS_SHARE_REPLAY_DEFAULTS","getFromObjectOrThrow","getProperty","newRxError","runPluginHooks","getDocumentDataOfRxChangeEvent","overwritable","getSchemaByObjectPath","throwIfIsStorageWriteError","modifierFromPublicToInternal","basePrototype","primaryPath","_this","isInstanceOfRxDocument","undefined","collection","schema","primary","_data","revision","_rev","deleted$","$","pipe","d","_deleted","deleted","getLatest","latestDocData","_docCache","getLatestDocumentData","getCachedRxDocument","changeEvent","isLocal","documentId","prev","curr","docData","get$","path","isDevMode","includes","finalFields","schemaObj","jsonSchema","data","populate","value","get","ref","refCollection","database","collections","type","findByIds","exec","then","res","valuesIterator","values","Array","from","findOne","objPath","fromCache","_propertyCache","valueObj","isArray","deepFreezeWhenDevMode","defineGetterSetter","set","toJSON","withMetaFields","_attachments","_meta","toMutableJSON","update","_updateObj","incrementalUpdate","updateCRDT","putAttachment","getAttachment","allAttachments","allAttachments$","modify","mutationFunction","_context","_this2","_asyncToGenerator","oldData","newData","_saveData","incrementalModify","incrementalWriteQueue","addWrite","result","patch","Object","entries","forEach","k","v","incrementalPatch","_this3","id","document","beforeDocumentUpdateWrite","writeResult","storageInstance","bulkWrite","previous","isError","error","_runHooks","success","remove","_this4","Promise","reject","deletedData","removedDocData","removed","incrementalRemove","_this5","_ref2","_x","apply","arguments","_ref3","newDoc","_x2","destroy","createRxDocumentConstructor","proto","constructor","RxDocumentConstructor","Map","prototype","thisObj","pathProperties","properties","keys","key","fullPath","__defineGetter__","ret","defineProperty","enumerable","configurable","__defineSetter__","val","createWithConstructor","jsonData","doc","isRxDocument","obj","assign","validateChange"],"sources":["/Users/caleblinden/Documents/GitHub/mmf-poc/mmf-poc/node_modules/rxdb/dist/es/rx-document.js"],"sourcesContent":["import { distinctUntilChanged, filter, map, shareReplay, startWith } from 'rxjs/operators';\nimport { clone, trimDots, pluginMissing, flatClone, PROMISE_RESOLVE_NULL, RXJS_SHARE_REPLAY_DEFAULTS, getFromObjectOrThrow, getProperty } from './plugins/utils';\nimport { newRxError } from './rx-error';\nimport { runPluginHooks } from './hooks';\nimport { getDocumentDataOfRxChangeEvent } from './rx-change-event';\nimport { overwritable } from './overwritable';\nimport { getSchemaByObjectPath } from './rx-schema-helper';\nimport { throwIfIsStorageWriteError } from './rx-storage-helper';\nimport { modifierFromPublicToInternal } from './incremental-write';\nexport var basePrototype = {\n  get primaryPath() {\n    var _this = this;\n    if (!_this.isInstanceOfRxDocument) {\n      return undefined;\n    }\n    return _this.collection.schema.primaryPath;\n  },\n  get primary() {\n    var _this = this;\n    if (!_this.isInstanceOfRxDocument) {\n      return undefined;\n    }\n    return _this._data[_this.primaryPath];\n  },\n  get revision() {\n    var _this = this;\n    if (!_this.isInstanceOfRxDocument) {\n      return undefined;\n    }\n    return _this._data._rev;\n  },\n  get deleted$() {\n    var _this = this;\n    if (!_this.isInstanceOfRxDocument) {\n      return undefined;\n    }\n    return _this.$.pipe(map(d => d._deleted));\n  },\n  get deleted() {\n    var _this = this;\n    if (!_this.isInstanceOfRxDocument) {\n      return undefined;\n    }\n    return _this._data._deleted;\n  },\n  getLatest() {\n    var latestDocData = this.collection._docCache.getLatestDocumentData(this.primary);\n    return this.collection._docCache.getCachedRxDocument(latestDocData);\n  },\n  /**\n   * returns the observable which emits the plain-data of this document\n   */\n  get $() {\n    var _this = this;\n    return _this.collection.$.pipe(filter(changeEvent => !changeEvent.isLocal), filter(changeEvent => changeEvent.documentId === this.primary), map(changeEvent => getDocumentDataOfRxChangeEvent(changeEvent)), startWith(_this.collection._docCache.getLatestDocumentData(this.primary)), distinctUntilChanged((prev, curr) => prev._rev === curr._rev), map(docData => this.collection._docCache.getCachedRxDocument(docData)), shareReplay(RXJS_SHARE_REPLAY_DEFAULTS));\n  },\n  /**\n   * returns observable of the value of the given path\n   */\n  get$(path) {\n    if (overwritable.isDevMode()) {\n      if (path.includes('.item.')) {\n        throw newRxError('DOC1', {\n          path\n        });\n      }\n      if (path === this.primaryPath) {\n        throw newRxError('DOC2');\n      }\n\n      // final fields cannot be modified and so also not observed\n      if (this.collection.schema.finalFields.includes(path)) {\n        throw newRxError('DOC3', {\n          path\n        });\n      }\n      var schemaObj = getSchemaByObjectPath(this.collection.schema.jsonSchema, path);\n      if (!schemaObj) {\n        throw newRxError('DOC4', {\n          path\n        });\n      }\n    }\n    return this.$.pipe(map(data => getProperty(data, path)), distinctUntilChanged());\n  },\n  /**\n   * populate the given path\n   */\n  populate(path) {\n    var schemaObj = getSchemaByObjectPath(this.collection.schema.jsonSchema, path);\n    var value = this.get(path);\n    if (!value) {\n      return PROMISE_RESOLVE_NULL;\n    }\n    if (!schemaObj) {\n      throw newRxError('DOC5', {\n        path\n      });\n    }\n    if (!schemaObj.ref) {\n      throw newRxError('DOC6', {\n        path,\n        schemaObj\n      });\n    }\n    var refCollection = this.collection.database.collections[schemaObj.ref];\n    if (!refCollection) {\n      throw newRxError('DOC7', {\n        ref: schemaObj.ref,\n        path,\n        schemaObj\n      });\n    }\n    if (schemaObj.type === 'array') {\n      return refCollection.findByIds(value).exec().then(res => {\n        var valuesIterator = res.values();\n        return Array.from(valuesIterator);\n      });\n    } else {\n      return refCollection.findOne(value).exec();\n    }\n  },\n  /**\n   * get data by objectPath\n   */\n  get(objPath) {\n    if (!this._data) {\n      return undefined;\n    }\n    var fromCache = this._propertyCache.get(objPath);\n    if (fromCache) {\n      return fromCache;\n    }\n    var valueObj = getProperty(this._data, objPath);\n\n    // direct return if array or non-object\n    if (typeof valueObj !== 'object' || Array.isArray(valueObj)) {\n      return overwritable.deepFreezeWhenDevMode(valueObj);\n    }\n\n    /**\n     * TODO find a way to deep-freeze together with defineGetterSetter\n     * so we do not have to do a deep clone here.\n     */\n    valueObj = clone(valueObj);\n    defineGetterSetter(this.collection.schema, valueObj, objPath, this);\n    this._propertyCache.set(objPath, valueObj);\n    return valueObj;\n  },\n  toJSON(withMetaFields = false) {\n    if (!withMetaFields) {\n      var data = flatClone(this._data);\n      delete data._rev;\n      delete data._attachments;\n      delete data._deleted;\n      delete data._meta;\n      return overwritable.deepFreezeWhenDevMode(data);\n    } else {\n      return overwritable.deepFreezeWhenDevMode(this._data);\n    }\n  },\n  toMutableJSON(withMetaFields = false) {\n    return clone(this.toJSON(withMetaFields));\n  },\n  /**\n   * updates document\n   * @overwritten by plugin (optional)\n   * @param updateObj mongodb-like syntax\n   */\n  update(_updateObj) {\n    throw pluginMissing('update');\n  },\n  incrementalUpdate(_updateObj) {\n    throw pluginMissing('update');\n  },\n  updateCRDT(_updateObj) {\n    throw pluginMissing('crdt');\n  },\n  putAttachment() {\n    throw pluginMissing('attachments');\n  },\n  getAttachment() {\n    throw pluginMissing('attachments');\n  },\n  allAttachments() {\n    throw pluginMissing('attachments');\n  },\n  get allAttachments$() {\n    throw pluginMissing('attachments');\n  },\n  async modify(mutationFunction,\n  // used by some plugins that wrap the method\n  _context) {\n    var oldData = this._data;\n    var newData = await modifierFromPublicToInternal(mutationFunction)(oldData);\n    return this._saveData(newData, oldData);\n  },\n  /**\n   * runs an incremental update over the document\n   * @param function that takes the document-data and returns a new data-object\n   */\n  incrementalModify(mutationFunction,\n  // used by some plugins that wrap the method\n  _context) {\n    return this.collection.incrementalWriteQueue.addWrite(this._data, modifierFromPublicToInternal(mutationFunction)).then(result => this.collection._docCache.getCachedRxDocument(result));\n  },\n  patch(patch) {\n    var oldData = this._data;\n    var newData = clone(oldData);\n    Object.entries(patch).forEach(([k, v]) => {\n      newData[k] = v;\n    });\n    return this._saveData(newData, oldData);\n  },\n  /**\n   * patches the given properties\n   */\n  incrementalPatch(patch) {\n    return this.incrementalModify(docData => {\n      Object.entries(patch).forEach(([k, v]) => {\n        docData[k] = v;\n      });\n      return docData;\n    });\n  },\n  /**\n   * saves the new document-data\n   * and handles the events\n   */\n  async _saveData(newData, oldData) {\n    newData = flatClone(newData);\n\n    // deleted documents cannot be changed\n    if (this._data._deleted) {\n      throw newRxError('DOC11', {\n        id: this.primary,\n        document: this\n      });\n    }\n    await beforeDocumentUpdateWrite(this.collection, newData, oldData);\n    var writeResult = await this.collection.storageInstance.bulkWrite([{\n      previous: oldData,\n      document: newData\n    }], 'rx-document-save-data');\n    var isError = writeResult.error[this.primary];\n    throwIfIsStorageWriteError(this.collection, this.primary, newData, isError);\n    await this.collection._runHooks('post', 'save', newData, this);\n    return this.collection._docCache.getCachedRxDocument(getFromObjectOrThrow(writeResult.success, this.primary));\n  },\n  /**\n   * Remove the document.\n   * Notice that there is no hard delete,\n   * instead deleted documents get flagged with _deleted=true.\n   */\n  remove() {\n    var collection = this.collection;\n    if (this.deleted) {\n      return Promise.reject(newRxError('DOC13', {\n        document: this,\n        id: this.primary\n      }));\n    }\n    var deletedData = flatClone(this._data);\n    var removedDocData;\n    return collection._runHooks('pre', 'remove', deletedData, this).then(async () => {\n      deletedData._deleted = true;\n      var writeResult = await collection.storageInstance.bulkWrite([{\n        previous: this._data,\n        document: deletedData\n      }], 'rx-document-remove');\n      var isError = writeResult.error[this.primary];\n      throwIfIsStorageWriteError(collection, this.primary, deletedData, isError);\n      return getFromObjectOrThrow(writeResult.success, this.primary);\n    }).then(removed => {\n      removedDocData = removed;\n      return this.collection._runHooks('post', 'remove', deletedData, this);\n    }).then(() => {\n      return this.collection._docCache.getCachedRxDocument(removedDocData);\n    });\n  },\n  incrementalRemove() {\n    return this.incrementalModify(async docData => {\n      await this.collection._runHooks('pre', 'remove', docData, this);\n      docData._deleted = true;\n      return docData;\n    }).then(async newDoc => {\n      await this.collection._runHooks('post', 'remove', newDoc._data, newDoc);\n      return newDoc;\n    });\n  },\n  destroy() {\n    throw newRxError('DOC14');\n  }\n};\nexport function createRxDocumentConstructor(proto = basePrototype) {\n  var constructor = function RxDocumentConstructor(collection, docData) {\n    this.collection = collection;\n\n    // assume that this is always equal to the doc-data in the database\n    this._data = docData;\n    this._propertyCache = new Map();\n\n    /**\n     * because of the prototype-merge,\n     * we can not use the native instanceof operator\n     */\n    this.isInstanceOfRxDocument = true;\n  };\n  constructor.prototype = proto;\n  return constructor;\n}\nexport function defineGetterSetter(schema, valueObj, objPath = '', thisObj = false) {\n  if (valueObj === null) {\n    return;\n  }\n  var pathProperties = getSchemaByObjectPath(schema.jsonSchema, objPath);\n  if (typeof pathProperties === 'undefined') return;\n  if (pathProperties.properties) pathProperties = pathProperties.properties;\n  Object.keys(pathProperties).forEach(key => {\n    var fullPath = trimDots(objPath + '.' + key);\n\n    // getter - value\n    valueObj.__defineGetter__(key, function () {\n      var _this = thisObj ? thisObj : this;\n      if (!_this.get || typeof _this.get !== 'function') {\n        /**\n         * When an object gets added to the state of a vuejs-component,\n         * it happens that this getter is called with another scope.\n         * To prevent errors, we have to return undefined in this case\n         */\n        return undefined;\n      }\n      var ret = _this.get(fullPath);\n      return ret;\n    });\n    // getter - observable$\n    Object.defineProperty(valueObj, key + '$', {\n      get: function () {\n        var _this = thisObj ? thisObj : this;\n        return _this.get$(fullPath);\n      },\n      enumerable: false,\n      configurable: false\n    });\n    // getter - populate_\n    Object.defineProperty(valueObj, key + '_', {\n      get: function () {\n        var _this = thisObj ? thisObj : this;\n        return _this.populate(fullPath);\n      },\n      enumerable: false,\n      configurable: false\n    });\n    // setter - value\n    valueObj.__defineSetter__(key, function (val) {\n      var _this = thisObj ? thisObj : this;\n      return _this.set(fullPath, val);\n    });\n  });\n}\nexport function createWithConstructor(constructor, collection, jsonData) {\n  var doc = new constructor(collection, jsonData);\n  runPluginHooks('createRxDocument', doc);\n  return doc;\n}\nexport function isRxDocument(obj) {\n  return typeof obj === 'object' && obj !== null && 'isInstanceOfRxDocument' in obj;\n}\nexport function beforeDocumentUpdateWrite(collection, newData, oldData) {\n  /**\n   * Meta values must always be merged\n   * instead of overwritten.\n   * This ensures that different plugins do not overwrite\n   * each others meta properties.\n   */\n  newData._meta = Object.assign({}, oldData._meta, newData._meta);\n\n  // ensure modifications are ok\n  if (overwritable.isDevMode()) {\n    collection.schema.validateChange(oldData, newData);\n  }\n  return collection._runHooks('pre', 'save', newData, oldData);\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}