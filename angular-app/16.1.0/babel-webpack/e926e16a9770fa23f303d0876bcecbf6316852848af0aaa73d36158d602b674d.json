{"ast":null,"code":"import { flatClone } from '../../plugins/utils';\nimport { getComposedPrimaryKeyOfDocumentData } from '../../rx-schema-helper';\n\n// does nothing\nexport var DEFAULT_MODIFIER = d => Promise.resolve(d);\nexport function swapDefaultDeletedTodeletedField(deletedField, doc) {\n  if (deletedField === '_deleted') {\n    return doc;\n  } else {\n    doc = flatClone(doc);\n    var isDeleted = !!doc._deleted;\n    doc[deletedField] = isDeleted;\n    delete doc._deleted;\n    return doc;\n  }\n}\n\n/**\n * Must be run over all plain document data\n * that was pulled from the remote.\n * Used to fill up fields or modify the deleted field etc.\n */\nexport function handlePulledDocuments(collection, deletedField, docs) {\n  return docs.map(doc => {\n    var useDoc = flatClone(doc);\n\n    /**\n     * Swap out the deleted field\n     */\n    if (deletedField !== '_deleted') {\n      var isDeleted = !!useDoc[deletedField];\n      useDoc._deleted = isDeleted;\n      delete useDoc[deletedField];\n    } else {\n      // ensure we have a boolean.\n      useDoc._deleted = !!useDoc._deleted;\n    }\n\n    /**\n     * Fill up composed primary\n     */\n    var primaryPath = collection.schema.primaryPath;\n    useDoc[primaryPath] = getComposedPrimaryKeyOfDocumentData(collection.schema.jsonSchema, useDoc);\n    return useDoc;\n  });\n}\n\n/**\n * Like normal promiseWait()\n * but will skip the wait time if the online-state changes.\n */\nexport function awaitRetry(collection, retryTime) {\n  if (typeof window === 'undefined' || typeof window !== 'object' || typeof window.addEventListener === 'undefined' || navigator.onLine) {\n    return collection.promiseWait(retryTime);\n  }\n  var listener;\n  var onlineAgain = new Promise(res => {\n    listener = () => {\n      window.removeEventListener('online', listener);\n      res();\n    };\n    window.addEventListener('online', listener);\n  });\n  return Promise.race([onlineAgain, collection.promiseWait(retryTime)]).then(() => {\n    window.removeEventListener('online', listener);\n  });\n}","map":{"version":3,"names":["flatClone","getComposedPrimaryKeyOfDocumentData","DEFAULT_MODIFIER","d","Promise","resolve","swapDefaultDeletedTodeletedField","deletedField","doc","isDeleted","_deleted","handlePulledDocuments","collection","docs","map","useDoc","primaryPath","schema","jsonSchema","awaitRetry","retryTime","window","addEventListener","navigator","onLine","promiseWait","listener","onlineAgain","res","removeEventListener","race","then"],"sources":["/Users/caleblinden/Documents/GitHub/mmf-poc/mmf-poc/node_modules/rxdb/dist/es/plugins/replication/replication-helper.js"],"sourcesContent":["import { flatClone } from '../../plugins/utils';\nimport { getComposedPrimaryKeyOfDocumentData } from '../../rx-schema-helper';\n\n// does nothing\nexport var DEFAULT_MODIFIER = d => Promise.resolve(d);\nexport function swapDefaultDeletedTodeletedField(deletedField, doc) {\n  if (deletedField === '_deleted') {\n    return doc;\n  } else {\n    doc = flatClone(doc);\n    var isDeleted = !!doc._deleted;\n    doc[deletedField] = isDeleted;\n    delete doc._deleted;\n    return doc;\n  }\n}\n\n/**\n * Must be run over all plain document data\n * that was pulled from the remote.\n * Used to fill up fields or modify the deleted field etc.\n */\nexport function handlePulledDocuments(collection, deletedField, docs) {\n  return docs.map(doc => {\n    var useDoc = flatClone(doc);\n\n    /**\n     * Swap out the deleted field\n     */\n    if (deletedField !== '_deleted') {\n      var isDeleted = !!useDoc[deletedField];\n      useDoc._deleted = isDeleted;\n      delete useDoc[deletedField];\n    } else {\n      // ensure we have a boolean.\n      useDoc._deleted = !!useDoc._deleted;\n    }\n\n    /**\n     * Fill up composed primary\n     */\n    var primaryPath = collection.schema.primaryPath;\n    useDoc[primaryPath] = getComposedPrimaryKeyOfDocumentData(collection.schema.jsonSchema, useDoc);\n    return useDoc;\n  });\n}\n\n/**\n * Like normal promiseWait()\n * but will skip the wait time if the online-state changes.\n */\nexport function awaitRetry(collection, retryTime) {\n  if (typeof window === 'undefined' || typeof window !== 'object' || typeof window.addEventListener === 'undefined' || navigator.onLine) {\n    return collection.promiseWait(retryTime);\n  }\n  var listener;\n  var onlineAgain = new Promise(res => {\n    listener = () => {\n      window.removeEventListener('online', listener);\n      res();\n    };\n    window.addEventListener('online', listener);\n  });\n  return Promise.race([onlineAgain, collection.promiseWait(retryTime)]).then(() => {\n    window.removeEventListener('online', listener);\n  });\n}\n"],"mappings":"AAAA,SAASA,SAAS,QAAQ,qBAAqB;AAC/C,SAASC,mCAAmC,QAAQ,wBAAwB;;AAE5E;AACA,OAAO,IAAIC,gBAAgB,GAAGC,CAAC,IAAIC,OAAO,CAACC,OAAO,CAACF,CAAC,CAAC;AACrD,OAAO,SAASG,gCAAgCA,CAACC,YAAY,EAAEC,GAAG,EAAE;EAClE,IAAID,YAAY,KAAK,UAAU,EAAE;IAC/B,OAAOC,GAAG;EACZ,CAAC,MAAM;IACLA,GAAG,GAAGR,SAAS,CAACQ,GAAG,CAAC;IACpB,IAAIC,SAAS,GAAG,CAAC,CAACD,GAAG,CAACE,QAAQ;IAC9BF,GAAG,CAACD,YAAY,CAAC,GAAGE,SAAS;IAC7B,OAAOD,GAAG,CAACE,QAAQ;IACnB,OAAOF,GAAG;EACZ;AACF;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO,SAASG,qBAAqBA,CAACC,UAAU,EAAEL,YAAY,EAAEM,IAAI,EAAE;EACpE,OAAOA,IAAI,CAACC,GAAG,CAACN,GAAG,IAAI;IACrB,IAAIO,MAAM,GAAGf,SAAS,CAACQ,GAAG,CAAC;;IAE3B;AACJ;AACA;IACI,IAAID,YAAY,KAAK,UAAU,EAAE;MAC/B,IAAIE,SAAS,GAAG,CAAC,CAACM,MAAM,CAACR,YAAY,CAAC;MACtCQ,MAAM,CAACL,QAAQ,GAAGD,SAAS;MAC3B,OAAOM,MAAM,CAACR,YAAY,CAAC;IAC7B,CAAC,MAAM;MACL;MACAQ,MAAM,CAACL,QAAQ,GAAG,CAAC,CAACK,MAAM,CAACL,QAAQ;IACrC;;IAEA;AACJ;AACA;IACI,IAAIM,WAAW,GAAGJ,UAAU,CAACK,MAAM,CAACD,WAAW;IAC/CD,MAAM,CAACC,WAAW,CAAC,GAAGf,mCAAmC,CAACW,UAAU,CAACK,MAAM,CAACC,UAAU,EAAEH,MAAM,CAAC;IAC/F,OAAOA,MAAM;EACf,CAAC,CAAC;AACJ;;AAEA;AACA;AACA;AACA;AACA,OAAO,SAASI,UAAUA,CAACP,UAAU,EAAEQ,SAAS,EAAE;EAChD,IAAI,OAAOC,MAAM,KAAK,WAAW,IAAI,OAAOA,MAAM,KAAK,QAAQ,IAAI,OAAOA,MAAM,CAACC,gBAAgB,KAAK,WAAW,IAAIC,SAAS,CAACC,MAAM,EAAE;IACrI,OAAOZ,UAAU,CAACa,WAAW,CAACL,SAAS,CAAC;EAC1C;EACA,IAAIM,QAAQ;EACZ,IAAIC,WAAW,GAAG,IAAIvB,OAAO,CAACwB,GAAG,IAAI;IACnCF,QAAQ,GAAGA,CAAA,KAAM;MACfL,MAAM,CAACQ,mBAAmB,CAAC,QAAQ,EAAEH,QAAQ,CAAC;MAC9CE,GAAG,CAAC,CAAC;IACP,CAAC;IACDP,MAAM,CAACC,gBAAgB,CAAC,QAAQ,EAAEI,QAAQ,CAAC;EAC7C,CAAC,CAAC;EACF,OAAOtB,OAAO,CAAC0B,IAAI,CAAC,CAACH,WAAW,EAAEf,UAAU,CAACa,WAAW,CAACL,SAAS,CAAC,CAAC,CAAC,CAACW,IAAI,CAAC,MAAM;IAC/EV,MAAM,CAACQ,mBAAmB,CAAC,QAAQ,EAAEH,QAAQ,CAAC;EAChD,CAAC,CAAC;AACJ"},"metadata":{},"sourceType":"module","externalDependencies":[]}